<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Wyślij wniosek — BigBag</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/auth.css') }}"
    />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="brand" href="{{ url_for('index') }}">PłockiBigBag.pl</a>
      </div>
    </header>

    <main class="auth-viewport">
      <div class="auth-container">
        <div class="auth-card">
          <h1>Nowy wniosek</h1>
          <p class="lead">
            Wypełnij formularz, aby złożyć wniosek o odbiór worków.
          </p>

          <form
            id="applicationForm"
            class="apply-form"
            novalidate
            method="post"
            enctype="multipart/form-data"
          >
            <label class="label" for="id_estate">Nieruchomość</label>
            <div class="field">
              <select name="id_estate" id="id_estate" required>
                <option value="">-- wybierz nieruchomość --</option>
                {% for estate in estates %}
                <option value="{{ estate.id_estate }}">
                  ul. {{ estate.street }} {{ estate.building_number }}{% if
                  estate.apartment_number %} m. {{ estate.apartment_number }}{%
                  endif %}
                </option>
                {% endfor %}
                <option value="new">+ Dodaj nową nieruchomość</option>
              </select>
              <div class="field-error"></div>
            </div>

            <div
              id="new_estate_fields"
              style="display: none; margin-top: 0.75rem"
            >
              <label class="label" for="new_est_osiedle">Osiedle</label>
              <div class="field">
                <select name="new_est_osiedle" id="new_est_osiedle">
                  <option value="">-- wybierz osiedle --</option>
                  <option value="1">Borowiczki</option>
                  <option value="2">Ciechomice</option>
                  <option value="3">Dworcowa</option>
                  <option value="2">Góry</option>
                  <option value="1">Imielnica</option>
                  <option value="3">Kochanowskiego</option>
                  <option value="2">Kolegialna</option>
                  <option value="3">Łukasiewicza</option>
                  <option value="2">Międzytorze</option>
                  <option value="4">Miodowa</option>
                  <option value="1">Podolszyce Pn.</option>
                  <option value="1">Podolszyce Pd.</option>
                  <option value="2">Pradolina Wisły</option>
                  <option value="2">Radziwie</option>
                  <option value="4">Skarpa</option>
                  <option value="4">Stare Miasto</option>
                  <option value="3">Trzepowo</option>
                  <option value="3">Tysiąclecia</option>
                  <option value="4">Winiary</option>
                  <option value="2">Wyszogrodzka</option>
                  <option value="1">Zielony Jar</option>
                </select>
                <div class="field-error"></div>
              </div>

              <label class="label" for="new_est_type">Typ nieruchomości</label>
              <div class="field">
                <select name="new_est_type" id="new_est_type">
                  <option value="">-- wybierz typ --</option>
                  <option value="mieszkanie">Mieszkanie</option>
                  <option value="dom">Dom jednorodzinny</option>
                </select>
                <div class="field-error"></div>
              </div>

              <label class="label" for="new_est_postal">Kod pocztowy</label>
              <div class="field">
                <input
                  type="text"
                  name="new_est_postal"
                  id="new_est_postal"
                  placeholder="09-400"
                  pattern="[0-9]{2}-[0-9]{3}"
                />
                <div class="field-error"></div>
              </div>

              <label class="label" for="new_est_street">Ulica</label>
              <div class="field">
                <input
                  type="text"
                  name="new_est_street"
                  id="new_est_street"
                  placeholder="ul. Wiślana"
                />
                <div class="field-error"></div>
              </div>

              <label class="label" for="new_est_building">Numer budynku</label>
              <div class="field">
                <input
                  type="text"
                  name="new_est_building"
                  id="new_est_building"
                  placeholder="12"
                />
                <div class="field-error"></div>
              </div>

              <label class="label" for="new_est_apartment"
                >Numer mieszkania (opcjonalnie)</label
              >
              <div class="field">
                <input
                  type="text"
                  name="new_est_apartment"
                  id="new_est_apartment"
                  placeholder="3A"
                />
                <div class="field-error"></div>
              </div>
            </div>

            <label class="label" for="bag_count">Liczba worków</label>
            <div class="field">
              <input
                type="number"
                name="bag_count"
                id="bag_count"
                min="1"
                value="1"
                required
              />
              <div class="field-error"></div>
            </div>

            <label class="label" for="bag_arrival_date"
              >Data dostarczenia (opcjonalnie)</label
            >
            <div class="field">
              <input
                type="date"
                name="bag_arrival_date"
                id="bag_arrival_date"
              />
              <div class="field-error"></div>
            </div>

            <label class="label" for="bag_depart_date"
              >Data odbioru (opcjonalnie)</label
            >
            <div class="field">
              <input type="date" name="bag_depart_date" id="bag_depart_date" />
              <div class="field-error"></div>
            </div>

            <label class="label" for="notes">Uwagi (opcjonalnie)</label>
            <div class="field">
              <textarea
                name="notes"
                id="notes"
                maxlength="256"
                rows="4"
                placeholder="Dodatkowe informacje (max 256 znaków)"
              ></textarea>
              <div class="field-error"></div>
            </div>

            <div id="file-attachment-container">
              <label class="label" for="new_est_attachment"
                >Zaświadczenie o opłacie za segregację (pdf / jpg / jpeg / png,
                max 10 MB) — wymagane dla mieszkań (bloki)</label
              >
              <div class="field" id="new_est_attachment_field">
                <input
                  type="file"
                  name="new_est_attachment"
                  id="new_est_attachment"
                  accept=".pdf,image/jpeg,image/jpg,image/png"
                />
                <span
                  class="file-name"
                  id="new_est_attachment_name"
                  aria-live="polite"
                ></span>
                <div class="field-error"></div>
              </div>
            </div>

            <!-- expose estates data as JSON so client JS can determine building types -->
            <div
              id="hidden_building_type"
              data-estates='{{ estates | tojson }}'
              hidden
            ></div>

            <div class="auth-actions">
              <button type="submit" class="btn btn-primary">
                Wyślij wniosek
              </button>
              <a
                class="btn btn-secondary"
                href="{{ url_for('resident_dashboard') }}"
                >Anuluj</a
              >
            </div>
          </form>
        </div>
      </div>
    </main>

    <script src="{{ url_for('static', filename='js/application_validation.js') }}"></script>
  </body>
</html>
