<!doctype html>
<html lang="pl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Panel mieszkańca — BigBag</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/base.css') }}"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/auth.css') }}"
    />
  </head>
  <body>
    <header class="site-header">
      <div class="container">
        <a class="brand" href="{{ url_for('index') }}">PłockiBigBag.pl</a>
      </div>
    </header>

    <main class="auth-viewport">
      <div class="auth-container">
        <div class="auth-card" role="main">
          <div id="dashboard-header">
            <h1>Witaj w panelu mieszkańca, {{ current_user.first_name }}!</h1>
          </div>
          <p class="lead">
            Z tego miejsca możesz wysłać nowy wniosek lub zobaczyć listę swoich
            zgłoszeń.
          </p>

          <div
            style="
              display: flex;
              flex-direction: column;
              gap: 1rem;
              align-items: center;
              margin-top: 1.5rem;
            "
          >
            <a class="btn btn-primary" href="{{ url_for('application_form') }}"
              >Wyślij nowy wniosek</a
            >
          </div>

          <!-- Applications table -->
          <div style="margin-top: 1.5rem; width: 100%">
            <h2>Twoje wnioski</h2>
            {% if applications and applications|length > 0 %}
            <div class="table-responsive">
              <table class="table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Adres</th>
                    <th>Status</th>
                    <th>Worki</th>
                    <th>Data dostarczenia</th>
                    <th>Data odbioru</th>
                    <th>Utworzono</th>
                    <th>Akcje</th>
                  </tr>
                </thead>
                <tbody>
                  {% for a in applications %}
                  <tr>
                    <td>{{ a.id_application }}</td>
                    <td>
                      ul. {{ a.street }} {{ a.building_number }}{% if a.apartment_number %}/{{ a.apartment_number }}{% endif %}
                    </td>
                    <td>
                      {% set status_label = '???' %}
                      {% if a.status == 'awaiting' %}
                        {% set status_label = 'Oczekujący' %}
                      {% elif a.status == 'in_progress' %}
                        {% set status_label = 'W trakcie' %}
                      {% elif a.status == 'approved' %}
                        {% set status_label = 'Zatwierdzony' %}
                      {% elif a.status == 'declined' %}
                        {% set status_label = 'Odrzucony' %}
                      {% else %}
                        {% set status_label = a.status %}
                      {% endif %}
                      <span class="status-badge status-{{ a.status|replace(' ', '_') }}">{{ status_label }}</span>
                    </td>
                    <td>{{ a.bag_count }}</td>
                    <td>{{ a.bag_arrival_date or '-' }}</td>
                    <td>{{ a.bag_depart_date or '-' }}</td>
                    <td>{{ a.creation_date }}</td>
                    <td>
                      <!-- placeholder for actions -->
                      <a class="action-link" href="#">Pokaż</a>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            {% else %}
            <p>Nie wysłałeś jeszcze żadnych wniosków.</p>
            {% endif %}
            <!-- pagination controls -->
            {% if total_pages and total_pages > 1 %}
            <div style="display:flex; gap:0.5rem; justify-content:center; margin-top:0.75rem;">
              {% if page > 1 %}
                <a class="btn" href="?page={{ page-1 }}">Poprzednia</a>
              {% endif %}
              {% for p in range(1, total_pages+1) %}
                {% if p == page %}
                  <span class="btn btn-secondary" style="font-weight:700;">{{ p }}</span>
                {% else %}
                  <a class="btn" href="?page={{ p }}">{{ p }}</a>
                {% endif %}
              {% endfor %}
              {% if page < total_pages %}
                <a class="btn" href="?page={{ page+1 }}">Następna</a>
              {% endif %}
            </div>
            {% endif %}
          </div>



          <div style="margin-top: 1.25rem; text-align: center">
            <a class="action-link" href="{{ url_for('index') }}"
              >Powrót do strony głównej</a
            >
          </div>
        </div>
      </div>
    </main>
  </body>
</html>
